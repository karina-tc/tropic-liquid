---
import beakerSvg from '/public/beaker.svg?raw';

const actions = [
  { id: 'filter-suppliers', icon: 'beaker', label: 'Filter Suppliers' },
  { id: 'filter-contracts', icon: 'beaker', label: 'Filter Contracts' },
  { id: 'filter-requests', icon: 'beaker', label: 'Filter Requests' },
  { id: 'create-request', icon: 'beaker', label: 'Create Request' },
  { id: 'negotiation', icon: 'beaker', label: 'Negotiation Intelligence' },
  { id: 'policy', icon: 'beaker', label: 'Policy Agent' },
  { id: 'support', icon: 'beaker', label: 'Support Agent' },
];
---

<header>
  <div class="text-lg">Tropic</div>
  <div class="search-container">
    <div class="input-wrapper">
      <div class="search-row">
        <span class="icon">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path opacity="0.2" d="M15.2204 11.8305L10.9165 13.4165L9.33051 17.7204C9.28671 17.839 9.20758 17.9414 9.1038 18.0138C9.00001 18.0861 8.87655 18.1248 8.75005 18.1248C8.62355 18.1248 8.50008 18.0861 8.3963 18.0138C8.29251 17.9414 8.21338 17.839 8.16958 17.7204L6.58364 13.4165L2.27973 11.8305C2.16106 11.7867 2.05866 11.7076 1.98634 11.6038C1.91402 11.5 1.87524 11.3765 1.87524 11.25C1.87524 11.1235 1.91402 11.0001 1.98634 10.8963C2.05866 10.7925 2.16106 10.7134 2.27973 10.6696L6.58364 9.08364L8.16958 4.77973C8.21338 4.66106 8.29251 4.55866 8.3963 4.48634C8.50008 4.41402 8.62355 4.37524 8.75005 4.37524C8.87655 4.37524 9.00001 4.41402 9.1038 4.48634C9.20758 4.55866 9.28671 4.66106 9.33051 4.77973L10.9165 9.08364L15.2204 10.6696C15.339 10.7134 15.4414 10.7925 15.5138 10.8963C15.5861 11.0001 15.6248 11.1235 15.6248 11.25C15.6248 11.3765 15.5861 11.5 15.5138 11.6038C15.4414 11.7076 15.339 11.7867 15.2204 11.8305Z" fill="#6C40ED"/>
          </svg>          
        </span>
        <input 
          type="text" 
          placeholder="Find or ask anything..." 
          class="search-input"
        />
      </div>
      <div class="utility-buttons">
        <button>
          <svg width="10" height="14" viewBox="0 0 10 14" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M4.99991 9.76923C5.73412 9.76846 6.43804 9.47646 6.95721 8.95729C7.47637 8.43813 7.76838 7.7342 7.76914 6.99999V3.30768C7.76914 2.57324 7.47738 1.86887 6.95805 1.34954C6.43872 0.83021 5.73435 0.538452 4.99991 0.538452C4.26546 0.538452 3.5611 0.83021 3.04177 1.34954C2.52243 1.86887 2.23068 2.57324 2.23068 3.30768V6.99999C2.23144 7.7342 2.52344 8.43813 3.04261 8.95729C3.56177 9.47646 4.2657 9.76846 4.99991 9.76923ZM3.15375 3.30768C3.15375 2.81805 3.34826 2.34848 3.69448 2.00226C4.0407 1.65603 4.51028 1.46153 4.99991 1.46153C5.48954 1.46153 5.95911 1.65603 6.30534 2.00226C6.65156 2.34848 6.84606 2.81805 6.84606 3.30768V6.99999C6.84606 7.48962 6.65156 7.9592 6.30534 8.30542C5.95911 8.65164 5.48954 8.84615 4.99991 8.84615C4.51028 8.84615 4.0407 8.65164 3.69448 8.30542C3.34826 7.9592 3.15375 7.48962 3.15375 6.99999V3.30768ZM5.46145 11.5923V13.4615C5.46145 13.5839 5.41282 13.7013 5.32626 13.7879C5.23971 13.8744 5.12232 13.9231 4.99991 13.9231C4.8775 13.9231 4.76011 13.8744 4.67355 13.7879C4.587 13.7013 4.53837 13.5839 4.53837 13.4615V11.5923C3.40047 11.4765 2.34592 10.9429 1.57866 10.0946C0.8114 9.24639 0.385927 8.14377 0.384521 6.99999C0.384521 6.87759 0.433148 6.76019 0.519703 6.67364C0.606258 6.58708 0.723652 6.53845 0.84606 6.53845C0.968468 6.53845 1.08586 6.58708 1.17242 6.67364C1.25897 6.76019 1.3076 6.87759 1.3076 6.99999C1.3076 7.97925 1.69661 8.91841 2.38905 9.61085C3.08149 10.3033 4.02065 10.6923 4.99991 10.6923C5.97917 10.6923 6.91832 10.3033 7.61076 9.61085C8.30321 8.91841 8.69222 7.97925 8.69222 6.99999C8.69222 6.87759 8.74084 6.76019 8.8274 6.67364C8.91395 6.58708 9.03135 6.53845 9.15376 6.53845C9.27616 6.53845 9.39356 6.58708 9.48011 6.67364C9.56667 6.76019 9.61529 6.87759 9.61529 6.99999C9.61389 8.14377 9.18842 9.24639 8.42115 10.0946C7.65389 10.9429 6.59935 11.4765 5.46145 11.5923Z" fill="#7C7C7C"/>
          </svg>                
        </button>
        <button>
          <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M10.7111 5.6734C10.754 5.71626 10.788 5.76716 10.8113 5.82319C10.8345 5.87922 10.8464 5.93928 10.8464 5.99994C10.8464 6.06059 10.8345 6.12065 10.8113 6.17668C10.788 6.23271 10.754 6.28361 10.7111 6.32647L5.97742 11.0572C5.37143 11.6632 4.54955 12.0035 3.6926 12.0035C2.83565 12.0034 2.01382 11.6629 1.4079 11.057C0.801987 10.451 0.461616 9.62909 0.46167 8.77214C0.461724 7.91518 0.802198 7.09335 1.40819 6.48743L7.13473 0.676666C7.56737 0.243572 8.15433 8.07665e-05 8.76649 -0.000243816C9.37865 -0.000568398 9.96587 0.242301 10.399 0.674935C10.8321 1.10757 11.0755 1.69453 11.0759 2.30669C11.0762 2.91885 10.8333 3.50607 10.4007 3.93917L4.673 9.74994C4.41288 10.0101 4.06009 10.1562 3.69223 10.1562C3.32437 10.1562 2.97158 10.0101 2.71146 9.74994C2.45135 9.48982 2.30521 9.13703 2.30521 8.76917C2.30521 8.40131 2.45135 8.04851 2.71146 7.7884L7.51723 2.90647C7.55933 2.86156 7.60999 2.82553 7.66622 2.80049C7.72245 2.77545 7.78312 2.76192 7.84467 2.76068C7.90621 2.75944 7.96738 2.77052 8.02457 2.79328C8.08177 2.81603 8.13383 2.85 8.17771 2.89318C8.22158 2.93636 8.25637 2.98788 8.28003 3.0447C8.30369 3.10153 8.31575 3.16251 8.31549 3.22407C8.31523 3.28562 8.30266 3.3465 8.27852 3.40313C8.25438 3.45975 8.21916 3.51097 8.17492 3.55378L3.36858 8.4409C3.32554 8.48359 3.29134 8.53434 3.26792 8.59025C3.2445 8.64616 3.23232 8.70614 3.23208 8.76675C3.23184 8.82737 3.24354 8.88744 3.26652 8.94354C3.28949 8.99963 3.32329 9.05065 3.36598 9.09369C3.40867 9.13672 3.45942 9.17092 3.51533 9.19434C3.57124 9.21776 3.63122 9.22994 3.69184 9.23018C3.75245 9.23042 3.81253 9.21872 3.86862 9.19575C3.92472 9.17277 3.97574 9.13897 4.01877 9.09628L9.74588 3.2884C10.006 3.02882 10.1523 2.67654 10.1527 2.30906C10.1531 1.94157 10.0075 1.58899 9.7479 1.32888C9.48832 1.06876 9.13604 0.922417 8.76856 0.922038C8.40108 0.92166 8.0485 1.06728 7.78838 1.32686L2.063 7.13532C1.84852 7.34946 1.67831 7.60375 1.5621 7.88368C1.44589 8.1636 1.38596 8.46367 1.38572 8.76675C1.38548 9.06984 1.44493 9.37 1.5607 9.65011C1.67646 9.93022 1.84626 10.1848 2.0604 10.3993C2.27455 10.6137 2.52884 10.784 2.80876 10.9002C3.08868 11.0164 3.38875 11.0763 3.69184 11.0765C3.99492 11.0768 4.29509 11.0173 4.57519 10.9016C4.8553 10.7858 5.10986 10.616 5.32435 10.4019L10.0586 5.67109C10.1454 5.5849 10.2629 5.53673 10.3853 5.53717C10.5077 5.5376 10.6248 5.5866 10.7111 5.6734Z" fill="#7C7C7C"/>
          </svg>            
        </button>
        <button>
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M14.1531 0.616272H1.84684C1.52045 0.616272 1.20744 0.745927 0.976653 0.976714C0.745866 1.2075 0.616211 1.52051 0.616211 1.8469V14.1531C0.616211 14.4795 0.745866 14.7925 0.976653 15.0233C1.20744 15.2541 1.52045 15.3838 1.84684 15.3838H14.1531C14.4795 15.3838 14.7925 15.2541 15.0233 15.0233C15.2541 14.7925 15.3837 14.4795 15.3837 14.1531V1.8469C15.3837 1.52051 15.2541 1.2075 15.0233 0.976714C14.7925 0.745927 14.4795 0.616272 14.1531 0.616272ZM14.1531 14.1531H1.84684V1.8469H14.1531V14.1531ZM11.6918 8.00002C11.6918 8.16321 11.627 8.31972 11.5116 8.43511C11.3962 8.55051 11.2397 8.61533 11.0765 8.61533H8.61527V11.0766C8.61527 11.2398 8.55045 11.3963 8.43505 11.5117C8.31966 11.6271 8.16315 11.6919 7.99996 11.6919C7.83677 11.6919 7.68026 11.6271 7.56487 11.5117C7.44948 11.3963 7.38465 11.2398 7.38465 11.0766V8.61533H4.9234C4.76021 8.61533 4.6037 8.55051 4.48831 8.43511C4.37291 8.31972 4.30809 8.16321 4.30809 8.00002C4.30809 7.83683 4.37291 7.68032 4.48831 7.56493C4.6037 7.44954 4.76021 7.38471 4.9234 7.38471H7.38465V4.92346C7.38465 4.76027 7.44948 4.60376 7.56487 4.48837C7.68026 4.37297 7.83677 4.30815 7.99996 4.30815C8.16315 4.30815 8.31966 4.37297 8.43505 4.48837C8.55045 4.60376 8.61527 4.76027 8.61527 4.92346V7.38471H11.0765C11.2397 7.38471 11.3962 7.44954 11.5116 7.56493C11.627 7.68032 11.6918 7.83683 11.6918 8.00002Z" fill="#7C7C7C"/>
          </svg>            
        </button>
        <button>
          /
        </button>
        <button class="w-6 h-6 rounded-full bg-black text-white">
          â€”
        </button>
      </div>
    </div>
    <div class="action-menu hidden" id="actionMenu">
      <h2 class="menu-greeting">Hey Taryn! How can I help you today?</h2>
      <div class="flex justify-between items-baseline">
        <h3 class="menu-title">Actions</h3>
        <a href="#" class="see-all hidden">See All</a>
      </div>
      <div class="actions-list">
        {actions.map(action => (
          <div class="action-item" data-id={action.id} data-label={action.label.toLowerCase()}>
            <span class="action-icon" set:html={beakerSvg} />
            <span>{action.label}</span>
          </div>
        ))}
      </div>
    </div>
  </div>
  <div class="avatar"></div>
</header>

<style>
  header {
    @apply bg-white h-14 w-full px-7
    border-b border-gray-100
    flex justify-between items-center
    text-base text-gray-500
    sticky top-0 inset-0;
  }
  .avatar {
    @apply w-8 h-8 rounded-full
    bg-gray-400 border border-white
    shadow-sm;
  }

  .search-container {
    @apply relative flex-1 max-w-2xl mx-4;
  }

  .input-wrapper {
    @apply flex flex-col w-full bg-white 
    rounded-full border border-gray-100
    hover:bg-white hover:border-gray-200
    transition-colors duration-200;
  }

  .search-row {
    @apply flex items-center w-full px-4;
  }

  .action-buttons-inline {
    @apply flex gap-2 text-gray-400;
  }

  .action-buttons-stacked {
    @apply flex gap-2 text-gray-400 px-4 py-2
    border-t border-gray-100;
  }

  .icon {
    @apply text-gray-400 w-5 h-5 absolute inset-0 top-2 left-3;
  }

  .search-input {
    @apply w-full py-2 bg-transparent outline-none
    text-gray-700 placeholder-gray-400;
  }

  .action-buttons {
    @apply flex gap-2 text-gray-400;
  }

  .action-menu {
    @apply absolute top-full left-0 w-full mt-2
    bg-white rounded-lg shadow-lg border border-gray-100
    p-4 pb-5 z-50;
  }

  .menu-greeting {
    @apply text-lg text-gray-950 font-semibold mb-3;
  }
  .menu-title {
    @apply text-gray-400 text-base mb-3;
  }

  .actions-list {
    @apply space-y-2;
  }

  .action-item {
    @apply flex flex-row items-center gap-3 py-1 rounded-md
    transition-all delay-100 cursor-pointer
    underline-offset-4 decoration-gray-200
    hover:underline;
  }

  .action-icon {
    @apply text-teal-600 w-5 h-5 flex items-center justify-center;
  }

  .action-icon svg {
    @apply w-3.5 h-3.5;
  }

  .see-all {
    @apply block text-right text-base text-gray-500
    underline-offset-4 underline decoration-gray-300
    hover:text-gray-700;
  }

  .hidden {
    display: none;
  }

  .avatar {
    @apply w-8 h-8 rounded-full
    bg-gray-400 border border-white
    shadow-sm;
  }

  .input-wrapper.focused {
    @apply rounded-lg mt-10;
  }

  .utility-buttons {
    @apply flex gap-2 text-gray-400;
    position: absolute;
    right: 1rem;
    top: 50%;
    transform: translateY(-50%);
  }

  .input-wrapper.focused .utility-buttons {
    position: static;
    transform: none;
    @apply w-full px-4 py-2 border-t border-gray-100;
  }

  .utility-buttons button {
    @apply hover:text-gray-600 transition-colors;
  }
</style>

<script>
  const input = document.querySelector('.search-input');
  const wrapper = document.querySelector('.input-wrapper');
  const actionMenu = document.getElementById('actionMenu');

  input?.addEventListener('focus', () => {
    actionMenu?.classList.remove('hidden');
    wrapper?.classList.add('focused');
  });

  document.addEventListener('click', (e) => {
    const target = e.target as HTMLElement;
    if (!target?.closest('.search-container')) {
      actionMenu?.classList.add('hidden');
      wrapper?.classList.remove('focused');
    }
  });

  input?.addEventListener('input', (e: Event) => {
    const target = e.target as HTMLInputElement;
    const value = target?.value.toLowerCase();
    let hasVisibleItems = false;
    const actionItems = document.querySelectorAll('[data-label]');
    actionItems.forEach((item: Element) => {
      const label = item.getAttribute('data-label') || '';
      if (label.toLowerCase().includes(value)) {
        item.classList.remove('hidden');
        hasVisibleItems = true;
      } else {
        item.classList.add('hidden');
      }
    });
    const seeAllLink = document.querySelector('.see-all-link');
    if (!hasVisibleItems && seeAllLink) {
      seeAllLink.classList.remove('hidden');
    } else if (seeAllLink) {
      seeAllLink.classList.add('hidden');
    }
  });

  // Close menu when clicking outside
  document.addEventListener('click', (e) => {
    const target = e.target as HTMLElement;
    if (!target?.closest('.search-container')) {
      actionMenu?.classList.add('hidden');
      wrapper?.classList.remove('focused');
    }
  });
  // Handle "See All" click
  const seeAllLink = document.querySelector('.see-all-link');
  const actionItems = document.querySelectorAll('[data-label]');
  seeAllLink?.addEventListener('click', (e: Event) => {
    e.preventDefault();
    actionItems.forEach((item: Element) => item.classList.remove('hidden'));
    seeAllLink?.classList.add('hidden');
  });
</script>
